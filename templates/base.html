{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="max-age=604800" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <title>
      {% block title %}GreatKart | One of the Biggest Online Shopping Platform{%
      endblock %}
    </title>

    <link
      href="{% static 'images/favicon.ico' %}"
      rel="shortcut icon"
      type="image/x-icon"
    />
    <script
      src="{% static 'js/jquery-2.0.0.min.js' %}"
      type="text/javascript"
    ></script>
    <script
      src="{% static 'js/bootstrap.bundle.min.js' %}"
      type="text/javascript"
    ></script>
    <link
      href="{% static 'css/bootstrap.css' %}"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="{% static 'fonts/fontawesome/css/all.min.css' %}"
      type="text/css"
      rel="stylesheet"
    />
    <link href="{% static 'css/ui.css' %}" rel="stylesheet" type="text/css" />
    <link
      href="{% static 'css/responsive.css' %}"
      rel="stylesheet"
      media="only screen and (max-width: 1200px)"
    />
    <script src="{% static 'js/script.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        // jQuery code
      });
      // jquery end
    </script>
    <script type="text/javascript">
      let csrftoken = Cookies.get("csrftoken");
      let price = document.getElementById("price").value;

      let token = undefined;
      function cardcreate() {
        let number = document.getElementById("number").value;
        let expire = document.getElementById("expire").value;
        var cardData = {
          id: 123,
          params: {
            card: { number: number, expire: expire },
            amount: parseInt(`${price.replace(".", "")}`),
            save: true,
          },
        };

        fetch("http://127.0.0.1:8000/en/api/payme/card/create/", {
          method: "POST",
          body: JSON.stringify(cardData),
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": csrftoken,
          },
        })
          .then((response) => response.json())
          .then((json) => {
            token = json.token;
          });
      }

      function checkcode() {
        var code = document.getElementById("code").value;

        let _data = {
          id: 123,
          params: {
            token: token,
            code: code,
          },
        };

        fetch("http://127.0.0.1:8000/en/api/payme/card/verify/", {
          method: "POST",
          body: JSON.stringify(_data),
          headers: {
            "Content-type": "application/json; charset=UTF-8",
            "X-CSRFToken": csrftoken,
          },
        })
          .then((response) => response.json())
          .then((json) => {
            data = {
              id: 123,
              params: {
                token: token,
                amount: parseInt(`${price.replace(".", "")}`),
                account: {
                  order_id: 1,
                },
              },
            };

            fetch("http://127.0.0.1:8000/en/api/payme/payment/", {
              method: "POST",
              body: JSON.stringify(data),
              headers: {
                "Content-type": "application/json; charset=UTF-8",
                "X-CSRFToken": csrftoken,
              },
            })
              .then((response) => response.json())
              .then((json) => {
                console.log(json);
              })
              .catch((err) => {
                console.log(err);
              });
          })
          .catch((err) => console.log(err));
      }
    </script>
  </head>

  <body>
    {% block header %} {% include 'includes/navbar.html' %} {% endblock %} {%
    block content %} {% endblock %} {% block footer %} {% include
    'includes/footer.html' %} {% endblock %}
  </body>
</html>
